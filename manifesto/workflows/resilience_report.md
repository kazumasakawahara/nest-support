# レジリエンス・レポート生成 (Resilience Report Workflow)

**マニフェスト価値:** 強靭性 (Resilience)
**使用場面:** 支援計画の策定・見直し、Parent Down Triggerからの呼び出し

---

## 概要

「もしも親が倒れたら」を想定し、現在の支援体制の強靭性（レジリエンス）を可視化するレポートを生成する。

このワークフローは2つの形で使われる：
1. **事前準備型:** 支援計画策定時に「もしもの時」のシミュレーションとして作成
2. **緊急対応型:** `protocols/parent_down.md` から呼び出され、実際に親が倒れた際のアクションプランとして作成

---

## 実行手順

### ステップ1：クライアント全体像の取得

→ `neo4j-support-db` スキルのテンプレート2（クライアントプロフィール）を `neo4j` MCP の `read_neo4j_cypher` で実行。

7本柱の全情報を把握する。特に以下に注目：
- 親（Relative）の情報と健康状態
- 既存のCareRole
- 現在利用中のサービス

### ステップ2：親のCareRole一覧の取得

以下のCypherを `neo4j` MCP の `read_neo4j_cypher` で実行:
```cypher
MATCH (c:Client {name: 'クライアント名'})<-[:IS_PARENT_OF|FAMILY_OF]-(r:Relative)
OPTIONAL MATCH (r)-[:PERFORMS]->(cr:CareRole)
OPTIONAL MATCH (cr)-[:CAN_BE_PERFORMED_BY]->(alt)
RETURN r.name AS 親, r.healthStatus AS 健康状態, r.age AS 年齢,
       cr.name AS タスク, cr.frequency AS 頻度,
       labels(alt) AS 代替種類, alt.name AS 代替名
ORDER BY r.name, cr.priority DESC
```

### ステップ3：代替手段のカバー率分析

各CareRoleについて代替手段の有無を判定し、カバー率を算出する。

| カバー状態 | アイコン | 意味 |
|-----------|---------|------|
| 完全カバー | ✅ | 代替サービスまたは代替人物が登録済み |
| 部分カバー | ⚠️ | 代替手段はあるが、頻度や質に不安 |
| 未カバー | 🚨 | 代替手段なし。緊急の支援調整が必要 |

### ステップ4：未カバーのタスクに対する候補検索

未カバーのCareRoleに対して、福祉サービスの候補を検索する。

→ `provider-search` スキルのテンプレート1（事業所検索）を `neo4j` MCP の `read_neo4j_cypher` で実行。
  条件: service_type, city, availability, target_disability で絞り込み。

口コミ情報がある場合は併せて確認：
→ `provider-search` スキルのテンプレート6（口コミ検索）を `neo4j` MCP の `read_neo4j_cypher` で実行。

### ステップ5：過去のナラティブからの洞察

過去の支援記録から、親の機能に関連する情報を抽出する。

→ `neo4j-support-db` スキルのテンプレート5（支援記録取得）を `neo4j` MCP の `read_neo4j_cypher` で実行（limit=30）。

例えば「食事準備」のCareRoleが未カバーの場合：
- 過去の記録から食事に関するこだわり（特定の味付け、避けるべき食材）を抽出
- この情報を代替サービスの選定基準に反映させる

### ステップ6：レポートの生成

以下の形式でレポートを構成する。

```markdown
# 🔄 レジリエンス・レポート

**対象クライアント:** [クライアント名]（[年齢]歳）
**レポート種類:** [事前準備型 / 緊急対応型]
**作成日:** [日付]
**シナリオ:** [想定する状況（例：母の長期入院）]

---

## 1. 親の現状

| 親 | 年齢 | 健康状態 | 担当タスク数 |
|---|------|---------|------------|
| [名前] | [年齢] | [状態] | [数] |

## 2. CareRoleのカバー状況

| # | タスク | 担当 | 頻度 | 代替手段 | ステータス |
|---|--------|------|------|----------|-----------|
| 1 | 食事準備 | 母 | 毎日 | ○○居宅介護 | ✅ |
| 2 | 金銭管理 | 母 | 月2回 | 社会福祉協議会 | ✅ |
| 3 | 送迎 | 母 | 週5 | — | 🚨 未カバー |
| 4 | 服薬管理 | 母 | 毎日 | 訪問看護△△ | ⚠️ 部分カバー |

**カバー率:** [X] / [Y] タスク = [Z]%

## 3. 🚨 即座のアクション（未カバーのタスク）

### 送迎（🚨 未カバー）
- **現状:** 母が毎朝、作業所への送迎を担当
- **候補サービス:**
  - [候補1] - [概要、口コミ評価]
  - [候補2] - [概要、口コミ評価]
- **推奨:** [具体的な提案]

## 4. 📋 本人のこだわり・配慮事項

過去の支援記録から抽出した、代替サービス選定時に考慮すべき情報：
- [食事の好み、こだわり]
- [生活リズム]
- [環境の好み]

## 5. 💰 経済的な影響

- 新規サービスの利用に必要な手続き
- 負担上限額への影響
- 利用可能な制度（高額障害福祉サービス等給付費等）

## 6. 📞 関係者連絡先

| 優先度 | 名前 | 続柄 | 電話番号 | 役割 |
|--------|------|------|---------|------|
| 1 | [名前] | [続柄] | [番号] | [役割] |

## 7. ⏭️ 次のステップ

- [ ] 未カバーのタスクについて、サービス利用の調整を開始
- [ ] キーパーソンへの状況共有
- [ ] [期間]後にカバー状況を再評価
```

---

## PDF/Excelでの出力

レポートをファイルとして出力する場合：

→ `html-to-pdf` スキルを使用してPDF出力、または `xlsx` スキルを使用してExcel出力。

※ レジリエンス・レポートの完全版は、Markdownから `html-to-pdf` スキルでHTML経由でPDFに変換する方法が推奨。
